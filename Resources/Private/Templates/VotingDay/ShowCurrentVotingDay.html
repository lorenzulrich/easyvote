{namespace v=Tx_Vhs_ViewHelpers}
{namespace ev=Tx_Easyvote_ViewHelpers}
<f:layout name="Default" />

This Template is responsible for creating a table of domain objects.

If you modify this template, do not forget to change the overwrite settings
in /Configuration/ExtensionBuilder/settings.yaml:
  Resources:
    Private:
      Templates:
        List.html: keep

Otherwise your changes will be overwritten the next time you save the extension in the extension builder

<f:section name="main">

<link rel="stylesheet" href="/typo3conf/ext/easyvote/Resources/Public/Stylesheets/easyvote.css" />


<div id="votingsDashboard">
	<section class="col-floatLeft col-marginRight col-left col-25">
		<f:if condition="{requestedKanton}">
			<f:then>
				<div class="flag-big flag-{v:format.case(string: requestedKanton.abbreviation, case: 'lower')}"></div>
			</f:then>
			<f:else>
				<div class="flag-big flag-ch"></div>
			</f:else>
		</f:if>
	</section>
	<section class="col-floatLeft col-marginRight col-50 col-middle">
		<f:for each="{votingDay.metaVotingProposals}" as="metaVotingProposal" iteration="metaIterator">
			<f:if condition="{metaVotingProposal.scope} == 1">
				<f:then>
					<f:render partial="MetaVotingProposal/SingleItem" arguments="{metaVotingProposal:metaVotingProposal, metaIterator:metaIterator, votingDay:votingDay}" />
				</f:then>
				<f:else>
					<f:if condition="{metaVotingProposal.kanton.uid} == {requestedKanton.uid}">
						<f:render partial="MetaVotingProposal/SingleItem" arguments="{metaVotingProposal:metaVotingProposal, metaIterator:metaIterator, votingDay:votingDay}" />
					</f:if>
				</f:else>
			</f:if>
		</f:for>
	</section>
	<section class="col-floatLeft col-25 col-right">
		<f:for each="{votingDay.metaVotingProposals}" as="metaVotingProposal">
			<f:if condition="{metaVotingProposal.scope} == 1">
				<f:then>
					<f:render partial="MetaVotingProposal/SingleNaviItem" arguments="{metaVotingProposal:metaVotingProposal, votingDay:votingDay}" />
				</f:then>
				<f:else>
					<f:if condition="{metaVotingProposal.kanton.uid} == {requestedKanton.uid}">
						<f:render partial="MetaVotingProposal/SingleNaviItem" arguments="{metaVotingProposal:metaVotingProposal, votingDay:votingDay}" />
					</f:if>
				</f:else>
			</f:if>
		</f:for>
	</section>

</div>

<script>
	$(function() {
		initializeVotings();
		bindNavigation();

		$('a#goToGegenvorschlag').click(function() {
			var jumpToId = $(this).closest('div').next().attr('id');
			scrollToElement('#' + jumpToId);
		});
		$('a#goToHauptvorlage').click(function() {
			var jumpToId = $(this).closest('div').prev().attr('id');
			scrollToElement('#' + jumpToId);
		});

		$('.toggle-trigger').click(function() {
			toggleBlock(this);
		});
	});

	function initializeVotings() {
		var currentVoting = $('.meta-abstimmungsvorlage-open').attr('id').split('-')[2];
		$('#meta-abstimmungsvorlage-navi-' + currentVoting).hide();
		$('#votingsDashboard').show();
	}

	function bindNavigation() {
		$('.meta-abstimmungsvorlage-navi').click(function() {
			var metaVotingId = $(this).attr('id').split('-')[3];
			$('.meta-abstimmungsvorlage-navi').unbind('click');
			openVoting(metaVotingId);
		});
	}

	function openVoting(metaVotingId) {
		var openVoting = $('.meta-abstimmungsvorlage-open').attr('id');
		var openVotingId = openVoting.split('-')[2];
		$('#' + openVoting).slideUp(500, function() {
			$('#meta-abstimmungsvorlage-navi-' + metaVotingId).slideUp(500, function() {
				$('#meta-abstimmungsvorlage-' + metaVotingId).slideDown(500, function() {
					$('#meta-abstimmungsvorlage-navi-' + openVotingId).slideDown(500, function() {
						$('#meta-abstimmungsvorlage-' + metaVotingId).toggleClass('meta-abstimmungsvorlage-open');
						$('#' + openVoting).toggleClass('meta-abstimmungsvorlage-open');
						bindNavigation();
					});
				});
			});
		});
	}

	function scrollToElement(elementId){
		$('html, body').animate({
			scrollTop: $(elementId).offset().top
		}, 1000);
	}

	function toggleBlock(trigger) {
		$('.toggle-handle', trigger).toggleClass('toggle-handle-plus').promise().done(function() {
			$(trigger).next().slideToggle(1000).toggleClass('toggle-closed');
		})
	}

</script>


</f:section>